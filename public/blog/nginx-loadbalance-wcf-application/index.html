<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    

<meta property="og:url" content="http://localhost:1313/blog/nginx-loadbalance-wcf-application/">
  <meta property="og:site_name" content="Nobuhiro Tokushige - AI & Cloud Solutions">
  <meta property="og:title" content="NGINX Load Balancer for WCF App">
  <meta property="og:description" content="This guide demonstrates how to implement a high-performance NGINX load balancer for WCF applications with the following features:
Enhanced security through SSL/TLS encryption Reliable session management using IP-based persistence Custom-tuned configurations for WCF service optimisation Advanced timeout and buffer settings to handle complex WCF payloads The configuration ensures reliable, secure, and efficient load balancing specifically optimised for WCF service applications, with built-in session persistence and performance tuning.
1. Install required packages and SSL certificates">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-04-21T20:23:55+10:00">
    <meta property="article:modified_time" content="2025-04-21T20:23:55+10:00">
    <meta property="article:tag" content="NGINX">
    <meta property="article:tag" content="WCF">
    <meta property="article:tag" content="SSL">
    <meta property="article:tag" content="Load Balancer">


<meta name="description" content="AI consultant and cloud solutions architect sharing practical insights on AWS, generative AI, and modern DevOps practices. Building the future of AI-powered applications." />
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Nobuhiro Tokushige - AI &amp; Cloud Solutions</title>
    
  
<link rel="icon" type="image/png" href="/images/favicon.png" />
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans:400,600" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/style.css">
<link rel="stylesheet" type="text/css" href="/css/icons.css">

<link rel="stylesheet" href="http://localhost:1313/custom.css">

  </head>
  <body>
    
    
    <div id="preloader">
      <div id="status"></div>
    </div>
    

    

<nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/images/logos/IntelliumX-v16.png" alt="" width="112" height="28">
      </a>
      <a class="navbar-item is-hidden-desktop is-hidden-tablet">
        <div id="menu-icon-wrapper" class="menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

      <div id="navbar-menu" class="navbar-menu is-static">
        <div class="navbar-start">
          <a class="navbar-item is-hidden-mobile">
            <div id="menu-icon-wrapper" class="menu-icon-wrapper" style="visibility: visible;">
              <svg width="1000px" height="1000px">
                <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
                <path class="path2" d="M 300 500 L 700 500"></path>
                <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
              </svg>
              <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
            </div>
          </a>
        </div>

        <div class="navbar-end">
          <a href="/" class="navbar-item is-secondary">
            Home
          </a>
          <a href="/projects/" class="navbar-item is-secondary">
            Projects
          </a>
          <a href="/blog/" class="navbar-item is-secondary">
            Blog
          </a>
          <a href="/about/" class="navbar-item is-secondary">
            About
          </a>
        </div>
      </div>
  </div>
</nav>


<nav id="navbar-clone" class="navbar is-fresh is-transparent" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/images/logos/IntelliumX-v16.png" alt="" width="112" height="28">
      </a>
      <a class="navbar-item is-hidden-desktop is-hidden-tablet">
        <div id="menu-icon-wrapper" class="menu-icon-wrapper" style="visibility: visible;">
          <svg width="1000px" height="1000px">
            <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
            <path class="path2" d="M 300 500 L 700 500"></path>
            <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
          </svg>
          <button id="menu-icon-trigger" class="menu-icon-trigger"></button>
        </div>
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="cloned-navbar-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="cloned-navbar-menu" class="navbar-menu is-fixed">
      <div class="navbar-start">
        <a class="navbar-item is-hidden-mobile">
          <div id="cloned-menu-icon-wrapper" class="menu-icon-wrapper" style="visibility: visible;">
            <svg width="1000px" height="1000px">
              <path class="path1" d="M 300 400 L 700 400 C 900 400 900 750 600 850 A 400 400 0 0 1 200 200 L 800 800"></path>
              <path class="path2" d="M 300 500 L 700 500"></path>
              <path class="path3" d="M 700 600 L 300 600 C 100 600 100 200 400 150 A 400 380 0 1 1 200 800 L 800 200"></path>
            </svg>
            <button id="cloned-menu-icon-trigger" class="menu-icon-trigger"></button>
          </div>
        </a>
      </div>

      <div class="navbar-end">
        <a href="/" class="navbar-item is-secondary">
          Home
        </a>
        <a href="/projects/" class="navbar-item is-secondary">
          Projects
        </a>
        <a href="/blog/" class="navbar-item is-secondary">
          Blog
        </a>
        <a href="/about/" class="navbar-item is-secondary">
          About
        </a>
      </div>
    </div>
</div>
</nav>


<section class="section is-small">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <h1 class="title is-2">NGINX Load Balancer for WCF App</h1>
        <p class="subtitle is-6">April 21, 2025</p>
        <div class="content"><p><img src="2025-04-21-23-29-03.png" alt=""></p>
<p>This guide demonstrates how to implement a high-performance NGINX load balancer for WCF applications with the following features:</p>
<ul>
<li>Enhanced security through SSL/TLS encryption</li>
<li>Reliable session management using IP-based persistence</li>
<li>Custom-tuned configurations for WCF service optimisation</li>
<li>Advanced timeout and buffer settings to handle complex WCF payloads</li>
</ul>
<p>The configuration ensures reliable, secure, and efficient load balancing specifically optimised for WCF service applications, with built-in session persistence and performance tuning.</p>
<p><strong>1. Install required packages and SSL certificates</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Update the operating system packages to latest versions</span>
</span></span><span style="display:flex;"><span>sudo yum update -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install NGINX (web server/load balancer), unzip (for certificate extraction), </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and tree (for directory visualization)</span>
</span></span><span style="display:flex;"><span>sudo yum install nginx unzip tree -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start the NGINX service and configure it to start on boot</span>
</span></span><span style="display:flex;"><span>sudo systemctl start nginx
</span></span><span style="display:flex;"><span>sudo systemctl enable nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Change to home directory and download SSL certificates from S3</span>
</span></span><span style="display:flex;"><span>cd ~
</span></span><span style="display:flex;"><span>aws s3 cp s3://<span style="color:#f92672">{</span>BUCKET NAME<span style="color:#f92672">}</span>/certs_v04.zip .
</span></span><span style="display:flex;"><span>unzip certs_v04.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Combine intermediate and root CA certificates into a bundle</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This creates the certificate chain needed for SSL verification</span>
</span></span><span style="display:flex;"><span>cat certs/mid-ca.crt certs/ca.crt &gt; certs/ca-bundle.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create SSL directory in NGINX and copy all certificates there</span>
</span></span><span style="display:flex;"><span>sudo mkdir -p /etc/nginx/ssl
</span></span><span style="display:flex;"><span>sudo cp certs/* /etc/nginx/ssl/
</span></span></code></pre></div><p><strong>2. Create the NGINX load balancer configuration file at <code>/etc/nginx/conf.d/bpserver-loadbalancer.conf</code> with the following settings</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>upstream bpserver_backend <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ip_hash;  <span style="color:#75715e"># Makes the client’s session “sticky” or “persistent” in terms of always trying to select a particular server</span>
</span></span><span style="display:flex;"><span>    server d11-app-bpe02.gcs.cloud:8199 max_fails<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> fail_timeout<span style="color:#f92672">=</span>30s;
</span></span><span style="display:flex;"><span>    server d11-app-bpe03.gcs.cloud:8199 max_fails<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> fail_timeout<span style="color:#f92672">=</span>30s;
</span></span><span style="display:flex;"><span>    server d11-app-bpe04.gcs.cloud:8199 max_fails<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> fail_timeout<span style="color:#f92672">=</span>30s;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    listen <span style="color:#ae81ff">8199</span> ssl;
</span></span><span style="display:flex;"><span>    server_name d11-lnx-alb01.gcs.cloud;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ssl_certificate     /etc/nginx/ssl/server_001.crt;
</span></span><span style="display:flex;"><span>    ssl_certificate_key /etc/nginx/ssl/server.key;
</span></span><span style="display:flex;"><span>    ssl_client_certificate /etc/nginx/ssl/ca-bundle.crt;
</span></span><span style="display:flex;"><span>    ssl_verify_client off;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ssl_protocols TLSv1.2 TLSv1.3;
</span></span><span style="display:flex;"><span>    ssl_ciphers HIGH:!aNULL:!MD5;
</span></span><span style="display:flex;"><span>    ssl_prefer_server_ciphers on;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        proxy_pass https://bpserver_backend;
</span></span><span style="display:flex;"><span>        proxy_ssl_verify off;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Additional headers for WCF</span>
</span></span><span style="display:flex;"><span>        proxy_set_header Host $host;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Increase timeouts for WCF operations</span>
</span></span><span style="display:flex;"><span>        proxy_connect_timeout 300s;
</span></span><span style="display:flex;"><span>        proxy_read_timeout 300s;
</span></span><span style="display:flex;"><span>        proxy_send_timeout 300s;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Preserve WCF headers</span>
</span></span><span style="display:flex;"><span>        proxy_pass_request_headers on;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Buffer settings for larger messages</span>
</span></span><span style="display:flex;"><span>        proxy_buffer_size 128k;
</span></span><span style="display:flex;"><span>        proxy_buffers <span style="color:#ae81ff">4</span> 256k;
</span></span><span style="display:flex;"><span>        proxy_busy_buffers_size 256k;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>3. Validate the NGINX configuration and restarting the service</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Test the NGINX configuration for syntax errors</span>
</span></span><span style="display:flex;"><span>sudo nginx -t
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Restart NGINX service to apply new configuration</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart nginx
</span></span></code></pre></div><p><strong>4. Verify ports established connections to the load balancer</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>netstat -nao | findstr <span style="color:#ae81ff">8199</span>
</span></span></code></pre></div><p><strong>5. Check Log Files (error log and access log)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># View error log in real-time</span>
</span></span><span style="display:flex;"><span>sudo tail -f /var/log/nginx/error.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># View access log in real-time</span>
</span></span><span style="display:flex;"><span>sudo tail -f /var/log/nginx/access.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># View last 100 lines of error log</span>
</span></span><span style="display:flex;"><span>sudo tail -n <span style="color:#ae81ff">100</span> /var/log/nginx/error.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Search for specific errors</span>
</span></span><span style="display:flex;"><span>sudo grep <span style="color:#e6db74">&#34;error&#34;</span> /var/log/nginx/error.log
</span></span></code></pre></div><p><strong>6. Adjust the logging level</strong></p>
<pre tabindex="0"><code>error_log /var/log/nginx/error.log warn;  # Levels: debug, info, notice, warn, error, crit, alert, emerg
</code></pre><p><strong>Reference:</strong></p>
<p><a href="https://www.f5.com/glossary/ssl-load-balancer">https://www.f5.com/glossary/ssl-load-balancer</a></p>
<p><a href="https://nginx.org/en/docs/http/load_balancing.html">https://nginx.org/en/docs/http/load_balancing.html</a></p>
<hr>
<h2 id="see-also">See also:</h2>
<p><a href="http://localhost:1313/blog/deploy-a-amazon-linux-2023/">Deploy a Amazon Linux 2023</a></p>
<p><a href="http://localhost:1313/blog/nginx-loadbalancer/">NGINX Load Balancer - Bare Metal</a></p>
<p><a href="http://localhost:1313/blog/nginx-loadbalancer-wcf-grpc/">NGINX Load Balancer for WCF &amp; gRPC</a></p>
<p><a href="http://localhost:1313/blog/nginx-container-test-web-page/">NGINX Container - Secure Web Page</a></p>
<p><a href="http://localhost:1313/blog/nginx-container-loadbalancer/">NGINX Container - Load Balancer</a></p>
<p><a href="http://localhost:1313/blog/haproxy-container-loadbalancer/">Haproxy Container - Load Balancer</a></p>
</div>
      </div>
    </div>
  </div>
</section>


<footer class="footer footer-dark">
  <div class="container">
    <div class="columns">
      <div class="column">
        <div class="footer-logo">
          <img src="/images/logos/IntelliumX-v15.png">
        </div>
      </div>
        <div class="column">
          <div class="footer-column">
            <div class="footer-header">
                <h3>Product</h3>
            </div>
            <ul class="link-list">
              <li>
                <a href="/">
                  Discover features
                </a>
              </li>
              <li>
                <a href="/">
                  Why choose our product?
                </a>
              </li>
              <li>
                <a href="/">
                  Compare features
                </a>
              </li>
              <li>
                <a href="/">
                  Our roadmap
                </a>
              </li>
              <li>
                <a href="/agb">
                  AGB
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="column">
          <div class="footer-column">
            <div class="footer-header">
                <h3>Docs</h3>
            </div>
            <ul class="link-list">
              <li>
                <a href="/">
                  Get started
                </a>
              </li>
              <li>
                <a href="/">
                  User guides
                </a>
              </li>
              <li>
                <a href="/">
                  Admin guide
                </a>
              </li>
              <li>
                <a href="/">
                  Developers
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="column">
          <div class="footer-column">
            <div class="footer-header">
                <h3>Blog</h3>
            </div>
            <ul class="link-list">
              <li>
                <a href="/blog/">
                  All Posts
                </a>
              </li>
              <li>
                <a href="/about/">
                  About
                </a>
              </li>
            </ul>
          </div>
        </div>
      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
            <h3>Follow Us</h3>
            <nav class="level is-mobile">
              <div class="level-left">
                <a class="level-item" href="https://www.linkedin.com/in/nobuhiro-tokushige/">
                  <span class="icon"><i class="fa fa-linkedin"></i></span>
                </a>
                <a class="level-item" href="https://github.com/nobuhiro-tokushige">
                  <span class="icon"><i class="fa fa-github"></i></span>
                </a>
              </div>
            </nav>
            <a href="https://bulma.io" target="_blank">
              <img src="/images/logos/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>



    
    <div id="backtotop"><a href="#"></a></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://unpkg.com/feather-icons"></script>
<script src="/js/fresh.js"></script>
<script src="/js/jquery.panelslider.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
<script src="/js/active-menu.js"></script>

  </body>
</html>
